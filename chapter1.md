# 线程基本概念

提及线程就不得不与进程对比。

- 一个进程中有一个或多个线程
- 同一个进程中的线程资源共享
- 线程是CPU调度的最小单元
- 进程是资源分配的最小单元
- ……

## 进程

**进程就是正在执行的程序代码的实时结果**[^1]。通俗地理解进程就是，启动一个Java程序，此时就启动了一个Java进程，打开音乐播放器就启动了一个音乐播放器的进程等等。不能将一个静态的程序理解为一个进程，一个进程一定是处于**执行期**的程序以及相关资源的总称。

在Linux中我们通过```ps```命令查看进程信息，例如我们需要强制关闭Tomcat，这时候就需要先通过```ps -ef |grep tomcat```命令查找Tomcat进程的PID，再通过```kill -9 PID```强制结束进程。

### 创建

进程通过调用```fork()```函数创建，调用```fork()```的进程为父进程，新产生的进程为子进程。

### 数据结构

进程在Linux内核中由```task_struct```数据结构定义，称为进程描述符，也常称为PCB。在PCB中定义了进程的状态等信息，PCB存放在内核的任务队列中。



## 线程

**线程是在进程中的活动对象**[^2]。线程是CPU调度的最小单元，CPU在调度执行程序时是以线程为最小单位，线程拥有独立的程序计数器等。

有的资料在介绍线程时，常常将线程称为"轻量级进程"。实际上在Linux系统中，线程仅仅是作为一个**特殊**的进程存在，它的结构同样是由```task_struct```定义。在同一个进程中，可以存在多个线程，多个线程之间资源共享，这就为后面的多线程并发造成的线程安全问题埋下了伏笔。



## JVM

Java最大的贡献并不是贡献出Java编程语言，而是虚拟机这一概念。这一概念使得"一次编译，到处运行"成为可能。Java的设计者通过虚拟机将不同操作系统与Java本身隔离，只需要通过虚拟机适配不同的操作系统，而将Java编译后在虚拟机上运行。所以Java语言既能称之为**编译型**，又能称为**解释型**语言，Java编译器先将Java编译成```.class```字节码文件，字节码在虚拟机上解释执行。

在我的理解看来，JVM就是Java世界里的"操作系统"，它管理内存、管理线程、管理一切，编写Java程序不需要考虑底层操作系统，一切都通过JVM来打理，在Java中创建的线程也是由JVM来管理。

<!--这里解释JVM中的线程与OS线程的映射关系，以及Java程序中的线程由谁来调度-->

[^1]: 《Linux内核设计与实现（第三版）》第3章 进程管理
[^2]: 同上